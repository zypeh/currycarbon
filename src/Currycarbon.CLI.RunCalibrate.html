<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Currycarbon.CLI.RunCalibrate</span><span>
</span><span id="line-2"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Currycarbon.CLI.RunCalibrate.html#CalibrateOptions"><span class="hs-identifier">CalibrateOptions</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Currycarbon.CLI.RunCalibrate.html#runCalibrate"><span class="hs-identifier">runCalibrate</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Currycarbon.CalCurves.Intcal20.html"><span class="hs-identifier">Currycarbon.CalCurves.Intcal20</span></a></span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Currycarbon.Calibration.html"><span class="hs-identifier">Currycarbon.Calibration</span></a></span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Currycarbon.Parsers.html"><span class="hs-identifier">Currycarbon.Parsers</span></a></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Currycarbon.Types.html"><span class="hs-identifier">Currycarbon.Types</span></a></span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">when</span></span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>         </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromJust</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isJust</span></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">System.IO</span></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">hPutStrLn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">stderr</span></span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-comment">-- | A data type to represent the options to the CLI module function runCalibrate</span><span>
</span><span id="line-14"></span><span class="hs-keyword">data</span><span> </span><span id="CalibrateOptions"><span class="annot"><a href="Currycarbon.CLI.RunCalibrate.html#CalibrateOptions"><span class="hs-identifier hs-var">CalibrateOptions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CalibrateOptions"><span class="annot"><a href="Currycarbon.CLI.RunCalibrate.html#CalibrateOptions"><span class="hs-identifier hs-var">CalibrateOptions</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-15"></span><span>        </span><span id="_calibrateUncalC14"><span class="annot"><span class="annottext">CalibrateOptions -&gt; [UncalC14]
</span><a href="Currycarbon.CLI.RunCalibrate.html#_calibrateUncalC14"><span class="hs-identifier hs-var hs-var">_calibrateUncalC14</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Currycarbon.Types.html#UncalC14"><span class="hs-identifier hs-type">UncalC14</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- ^ Uncalibrated dates that should be calibrated</span><span>
</span><span id="line-16"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="_calibrateUncalC14File"><span class="annot"><span class="annottext">CalibrateOptions -&gt; [FilePath]
</span><a href="Currycarbon.CLI.RunCalibrate.html#_calibrateUncalC14File"><span class="hs-identifier hs-var hs-var">_calibrateUncalC14File</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ List of files with uncalibrated dates to be calibrated</span><span>
</span><span id="line-17"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="_calibrateCalCurveFile"><span class="annot"><span class="annottext">CalibrateOptions -&gt; Maybe FilePath
</span><a href="Currycarbon.CLI.RunCalibrate.html#_calibrateCalCurveFile"><span class="hs-identifier hs-var hs-var">_calibrateCalCurveFile</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-comment">-- ^ Path to a .14c file</span><span>
</span><span id="line-18"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="_calibrateQuickOut"><span class="annot"><span class="annottext">CalibrateOptions -&gt; Bool
</span><a href="Currycarbon.CLI.RunCalibrate.html#_calibrateQuickOut"><span class="hs-identifier hs-var hs-var">_calibrateQuickOut</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-comment">-- ^ Should a short output string be printed to the command line for every date</span><span>
</span><span id="line-19"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="_calibrateDensityFile"><span class="annot"><span class="annottext">CalibrateOptions -&gt; Maybe FilePath
</span><a href="Currycarbon.CLI.RunCalibrate.html#_calibrateDensityFile"><span class="hs-identifier hs-var hs-var">_calibrateDensityFile</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-comment">-- ^ Path to an output file (see CLI documentation)</span><span>
</span><span id="line-20"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="_calibrateHDRFile"><span class="annot"><span class="annottext">CalibrateOptions -&gt; Maybe FilePath
</span><a href="Currycarbon.CLI.RunCalibrate.html#_calibrateHDRFile"><span class="hs-identifier hs-var hs-var">_calibrateHDRFile</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-comment">-- ^ Path to an output file</span><span>
</span><span id="line-21"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="_calibrateCalCurveSegmentFile"><span class="annot"><span class="annottext">CalibrateOptions -&gt; Maybe FilePath
</span><a href="Currycarbon.CLI.RunCalibrate.html#_calibrateCalCurveSegmentFile"><span class="hs-identifier hs-var hs-var">_calibrateCalCurveSegmentFile</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-comment">-- ^ Path to an output file </span><span>
</span><span id="line-22"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="_calibrateCalCurveMatrixFile"><span class="annot"><span class="annottext">CalibrateOptions -&gt; Maybe FilePath
</span><a href="Currycarbon.CLI.RunCalibrate.html#_calibrateCalCurveMatrixFile"><span class="hs-identifier hs-var hs-var">_calibrateCalCurveMatrixFile</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-comment">-- ^ Path to an output file </span><span>
</span><span id="line-23"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-comment">-- | Interface function to trigger calibration from the command line</span><span>
</span><span id="line-26"></span><span class="annot"><a href="Currycarbon.CLI.RunCalibrate.html#runCalibrate"><span class="hs-identifier hs-type">runCalibrate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Currycarbon.CLI.RunCalibrate.html#CalibrateOptions"><span class="hs-identifier hs-type">CalibrateOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span id="runCalibrate"><span class="annot"><span class="annottext">runCalibrate :: CalibrateOptions -&gt; IO ()
</span><a href="Currycarbon.CLI.RunCalibrate.html#runCalibrate"><span class="hs-identifier hs-var hs-var">runCalibrate</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Currycarbon.CLI.RunCalibrate.html#CalibrateOptions"><span class="hs-identifier hs-type">CalibrateOptions</span></a></span><span> </span><span id="local-6989586621679043015"><span class="annot"><span class="annottext">[UncalC14]
</span><a href="#local-6989586621679043015"><span class="hs-identifier hs-var">uncalDates</span></a></span></span><span> </span><span id="local-6989586621679043014"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621679043014"><span class="hs-identifier hs-var">uncalFile</span></a></span></span><span> </span><span id="local-6989586621679043013"><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621679043013"><span class="hs-identifier hs-var">calCurveFile</span></a></span></span><span> </span><span id="local-6989586621679043012"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679043012"><span class="hs-identifier hs-var">quickOut</span></a></span></span><span> </span><span id="local-6989586621679043011"><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621679043011"><span class="hs-identifier hs-var">densityFile</span></a></span></span><span> </span><span id="local-6989586621679043010"><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621679043010"><span class="hs-identifier hs-var">hdrFile</span></a></span></span><span> </span><span id="local-6989586621679043009"><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621679043009"><span class="hs-identifier hs-var">calCurveSegmentFile</span></a></span></span><span> </span><span id="local-6989586621679043008"><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621679043008"><span class="hs-identifier hs-var">calCurveMatrixFile</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-28"></span><span>    </span><span class="hs-comment">-- compile dates</span><span>
</span><span id="line-29"></span><span>    </span><span id="local-6989586621679043007"><span class="annot"><span class="annottext">[[UncalC14]]
</span><a href="#local-6989586621679043007"><span class="hs-identifier hs-var">entitiesFromFile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; IO [UncalC14]) -&gt; [FilePath] -&gt; IO [[UncalC14]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO [UncalC14]
</span><a href="Currycarbon.Parsers.html#readUncalC14FromFile"><span class="hs-identifier hs-var">readUncalC14FromFile</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621679043014"><span class="hs-identifier hs-var">uncalFile</span></a></span><span>
</span><span id="line-30"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679043004"><span class="annot"><span class="annottext">dates :: [UncalC14]
</span><a href="#local-6989586621679043004"><span class="hs-identifier hs-var hs-var">dates</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UncalC14] -&gt; [UncalC14]
</span><a href="Currycarbon.CLI.RunCalibrate.html#replaceEmptyNames"><span class="hs-identifier hs-var">replaceEmptyNames</span></a></span><span> </span><span class="annot"><span class="annottext">([UncalC14] -&gt; [UncalC14]) -&gt; [UncalC14] -&gt; [UncalC14]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[UncalC14]
</span><a href="#local-6989586621679043015"><span class="hs-identifier hs-var">uncalDates</span></a></span><span> </span><span class="annot"><span class="annottext">[UncalC14] -&gt; [UncalC14] -&gt; [UncalC14]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[[UncalC14]] -&gt; [UncalC14]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">[[UncalC14]]
</span><a href="#local-6989586621679043007"><span class="hs-identifier hs-var">entitiesFromFile</span></a></span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[UncalC14] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[UncalC14]
</span><a href="#local-6989586621679043004"><span class="hs-identifier hs-var">dates</span></a></span><span>
</span><span id="line-32"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; FilePath -&gt; IO ()
</span><span class="hs-identifier hs-var">hPutStrLn</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><span class="hs-identifier hs-var">stderr</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Nothing to calibrate. See currycarbon calibrate -h&quot;</span></span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-34"></span><span>        </span><span class="hs-comment">-- basic calibration</span><span>
</span><span id="line-35"></span><span>        </span><span class="annot"><span class="annottext">Handle -&gt; FilePath -&gt; IO ()
</span><span class="hs-identifier hs-var">hPutStrLn</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><span class="hs-identifier hs-var">stderr</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Calibrating...&quot;</span></span><span>
</span><span id="line-36"></span><span>        </span><span id="local-6989586621679043000"><span class="annot"><span class="annottext">CalCurve
</span><a href="#local-6989586621679043000"><span class="hs-identifier hs-var">calCurve</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO CalCurve
-&gt; (FilePath -&gt; IO CalCurve) -&gt; Maybe FilePath -&gt; IO CalCurve
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CalCurve -&gt; IO CalCurve
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(CalCurve -&gt; IO CalCurve) -&gt; CalCurve -&gt; IO CalCurve
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; CalCurve
</span><a href="Currycarbon.Parsers.html#loadCalCurve"><span class="hs-identifier hs-var">loadCalCurve</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="Currycarbon.CalCurves.Intcal20.html#intcal20"><span class="hs-identifier hs-var">intcal20</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO CalCurve
</span><a href="Currycarbon.Parsers.html#readCalCurve"><span class="hs-identifier hs-var">readCalCurve</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621679043013"><span class="hs-identifier hs-var">calCurveFile</span></a></span><span>
</span><span id="line-37"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679042995"><span class="annot"><span class="annottext">calPDFs :: [CalPDF]
</span><a href="#local-6989586621679042995"><span class="hs-identifier hs-var hs-var">calPDFs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CalCurve -&gt; [UncalC14] -&gt; [CalPDF]
</span><a href="Currycarbon.Calibration.html#calibrateMany"><span class="hs-identifier hs-var">calibrateMany</span></a></span><span> </span><span class="annot"><span class="annottext">CalCurve
</span><a href="#local-6989586621679043000"><span class="hs-identifier hs-var">calCurve</span></a></span><span> </span><span class="annot"><span class="annottext">[UncalC14]
</span><a href="#local-6989586621679043004"><span class="hs-identifier hs-var">dates</span></a></span><span>
</span><span id="line-38"></span><span>        </span><span class="hs-comment">-- write density file</span><span>
</span><span id="line-39"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe FilePath -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621679043011"><span class="hs-identifier hs-var">densityFile</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-40"></span><span>            </span><span class="annot"><span class="annottext">FilePath -&gt; [CalPDF] -&gt; IO ()
</span><a href="Currycarbon.Parsers.html#writeCalPDFs"><span class="hs-identifier hs-var">writeCalPDFs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe FilePath -&gt; FilePath
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621679043011"><span class="hs-identifier hs-var">densityFile</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CalPDF]
</span><a href="#local-6989586621679042995"><span class="hs-identifier hs-var">calPDFs</span></a></span><span>
</span><span id="line-41"></span><span>        </span><span class="hs-comment">-- print or write high density regions</span><span>
</span><span id="line-42"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679043012"><span class="hs-identifier hs-var">quickOut</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Maybe FilePath -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621679043010"><span class="hs-identifier hs-var">hdrFile</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-43"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679042991"><span class="annot"><span class="annottext">calC14s :: [CalC14]
</span><a href="#local-6989586621679042991"><span class="hs-identifier hs-var hs-var">calC14s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CalPDF] -&gt; [CalC14]
</span><a href="Currycarbon.Calibration.html#refineCal"><span class="hs-identifier hs-var">refineCal</span></a></span><span> </span><span class="annot"><span class="annottext">[CalPDF]
</span><a href="#local-6989586621679042995"><span class="hs-identifier hs-var">calPDFs</span></a></span><span>
</span><span id="line-44"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679043012"><span class="hs-identifier hs-var">quickOut</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-45"></span><span>                </span><span class="annot"><span class="annottext">FilePath -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; IO ()) -&gt; FilePath -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[CalC14] -&gt; FilePath
</span><a href="Currycarbon.Parsers.html#renderCalC14s"><span class="hs-identifier hs-var">renderCalC14s</span></a></span><span> </span><span class="annot"><span class="annottext">[CalC14]
</span><a href="#local-6989586621679042991"><span class="hs-identifier hs-var">calC14s</span></a></span><span>
</span><span id="line-46"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe FilePath -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621679043010"><span class="hs-identifier hs-var">hdrFile</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-47"></span><span>                </span><span class="annot"><span class="annottext">FilePath -&gt; [CalC14] -&gt; IO ()
</span><a href="Currycarbon.Parsers.html#writeCalC14s"><span class="hs-identifier hs-var">writeCalC14s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe FilePath -&gt; FilePath
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621679043010"><span class="hs-identifier hs-var">hdrFile</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CalC14]
</span><a href="#local-6989586621679042991"><span class="hs-identifier hs-var">calC14s</span></a></span><span>
</span><span id="line-48"></span><span>        </span><span class="hs-comment">-- write calcurve segment file</span><span>
</span><span id="line-49"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe FilePath -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621679043009"><span class="hs-identifier hs-var">calCurveSegmentFile</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Maybe FilePath -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621679043008"><span class="hs-identifier hs-var">calCurveMatrixFile</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-50"></span><span>            </span><span class="annot"><span class="annottext">Handle -&gt; FilePath -&gt; IO ()
</span><span class="hs-identifier hs-var">hPutStrLn</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><span class="hs-identifier hs-var">stderr</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; IO ()) -&gt; FilePath -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;The calCurveSegment file and the calCurveMatrix file only consider the first date: &quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-51"></span><span>                            </span><span class="annot"><span class="annottext">UncalC14 -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UncalC14] -&gt; UncalC14
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[UncalC14]
</span><a href="#local-6989586621679043004"><span class="hs-identifier hs-var">dates</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679042984"><span class="annot"><span class="annottext">uncalPDF :: UncalPDF
</span><a href="#local-6989586621679042984"><span class="hs-identifier hs-var hs-var">uncalPDF</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UncalC14 -&gt; UncalPDF
</span><a href="Currycarbon.Calibration.html#uncalToPDF"><span class="hs-identifier hs-var">uncalToPDF</span></a></span><span> </span><span class="annot"><span class="annottext">(UncalC14 -&gt; UncalPDF) -&gt; UncalC14 -&gt; UncalPDF
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[UncalC14] -&gt; UncalC14
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[UncalC14]
</span><a href="#local-6989586621679043004"><span class="hs-identifier hs-var">dates</span></a></span><span>
</span><span id="line-53"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621679042982"><span class="annot"><span class="annottext">CalCurve
</span><a href="#local-6989586621679042982"><span class="hs-identifier hs-var">calCurveSegment</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679042981"><span class="annot"><span class="annottext">CalCurveMatrix
</span><a href="#local-6989586621679042981"><span class="hs-identifier hs-var">calCurveMatric</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CalCurve -&gt; UncalPDF -&gt; (CalCurve, CalCurveMatrix)
</span><a href="Currycarbon.Calibration.html#prepareCalCurve"><span class="hs-identifier hs-var">prepareCalCurve</span></a></span><span> </span><span class="annot"><span class="annottext">CalCurve
</span><a href="#local-6989586621679043000"><span class="hs-identifier hs-var">calCurve</span></a></span><span> </span><span class="annot"><span class="annottext">UncalPDF
</span><a href="#local-6989586621679042984"><span class="hs-identifier hs-var">uncalPDF</span></a></span><span>
</span><span id="line-54"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe FilePath -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621679043009"><span class="hs-identifier hs-var">calCurveSegmentFile</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-55"></span><span>                </span><span class="annot"><span class="annottext">FilePath -&gt; CalCurve -&gt; IO ()
</span><a href="Currycarbon.Parsers.html#writeCalCurveFile"><span class="hs-identifier hs-var">writeCalCurveFile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe FilePath -&gt; FilePath
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621679043009"><span class="hs-identifier hs-var">calCurveSegmentFile</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CalCurve
</span><a href="#local-6989586621679042982"><span class="hs-identifier hs-var">calCurveSegment</span></a></span><span>
</span><span id="line-56"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe FilePath -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621679043008"><span class="hs-identifier hs-var">calCurveMatrixFile</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-57"></span><span>                </span><span class="annot"><span class="annottext">FilePath -&gt; CalCurveMatrix -&gt; IO ()
</span><a href="Currycarbon.Parsers.html#writeCalCurveMatrixFile"><span class="hs-identifier hs-var">writeCalCurveMatrixFile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe FilePath -&gt; FilePath
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621679043008"><span class="hs-identifier hs-var">calCurveMatrixFile</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CalCurveMatrix
</span><a href="#local-6989586621679042981"><span class="hs-identifier hs-var">calCurveMatric</span></a></span><span>
</span><span id="line-58"></span><span>        </span><span class="hs-comment">-- finished</span><span>
</span><span id="line-59"></span><span>        </span><span class="annot"><span class="annottext">Handle -&gt; FilePath -&gt; IO ()
</span><span class="hs-identifier hs-var">hPutStrLn</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><span class="hs-identifier hs-var">stderr</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Done&quot;</span></span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="hs-comment">-- | Helper function to replace empty input names with a sequence of numbers, </span><span>
</span><span id="line-62"></span><span class="hs-comment">-- to get each input date an unique identifier</span><span>
</span><span id="line-63"></span><span class="annot"><a href="Currycarbon.CLI.RunCalibrate.html#replaceEmptyNames"><span class="hs-identifier hs-type">replaceEmptyNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Currycarbon.Types.html#UncalC14"><span class="hs-identifier hs-type">UncalC14</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Currycarbon.Types.html#UncalC14"><span class="hs-identifier hs-type">UncalC14</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-64"></span><span id="replaceEmptyNames"><span class="annot"><span class="annottext">replaceEmptyNames :: [UncalC14] -&gt; [UncalC14]
</span><a href="Currycarbon.CLI.RunCalibrate.html#replaceEmptyNames"><span class="hs-identifier hs-var hs-var">replaceEmptyNames</span></a></span></span><span> </span><span id="local-6989586621679042977"><span class="annot"><span class="annottext">[UncalC14]
</span><a href="#local-6989586621679042977"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-65"></span><span>    </span><span class="annot"><span class="annottext">(UncalC14 -&gt; Int -&gt; UncalC14) -&gt; [UncalC14] -&gt; [Int] -&gt; [UncalC14]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">UncalC14 -&gt; Int -&gt; UncalC14
</span><a href="#local-6989586621679042975"><span class="hs-identifier hs-var">replaceName</span></a></span><span> </span><span class="annot"><span class="annottext">[UncalC14]
</span><a href="#local-6989586621679042977"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-67"></span><span>        </span><span class="annot"><a href="#local-6989586621679042975"><span class="hs-identifier hs-type">replaceName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Currycarbon.Types.html#UncalC14"><span class="hs-identifier hs-type">UncalC14</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Currycarbon.Types.html#UncalC14"><span class="hs-identifier hs-type">UncalC14</span></a></span><span>
</span><span id="line-68"></span><span>        </span><span id="local-6989586621679042975"><span class="annot"><span class="annottext">replaceName :: UncalC14 -&gt; Int -&gt; UncalC14
</span><a href="#local-6989586621679042975"><span class="hs-identifier hs-var hs-var">replaceName</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Currycarbon.Types.html#UncalC14"><span class="hs-identifier hs-type">UncalC14</span></a></span><span> </span><span id="local-6989586621679042973"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679042973"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679042972"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679042972"><span class="hs-identifier hs-var">mean</span></a></span></span><span> </span><span id="local-6989586621679042971"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679042971"><span class="hs-identifier hs-var">std</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679042970"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679042970"><span class="hs-identifier hs-var">number</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-69"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679042973"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;unknownSampleName&quot;</span></span><span>
</span><span id="line-70"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Int -&gt; Int -&gt; UncalC14
</span><a href="Currycarbon.Types.html#UncalC14"><span class="hs-identifier hs-var">UncalC14</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679042970"><span class="hs-identifier hs-var">number</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679042972"><span class="hs-identifier hs-var">mean</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679042971"><span class="hs-identifier hs-var">std</span></a></span><span>
</span><span id="line-71"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Int -&gt; Int -&gt; UncalC14
</span><a href="Currycarbon.Types.html#UncalC14"><span class="hs-identifier hs-var">UncalC14</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679042973"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679042972"><span class="hs-identifier hs-var">mean</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679042971"><span class="hs-identifier hs-var">std</span></a></span></pre></body></html>